<!DOCTYPE html>
<html>
  <head>
    <title>Nice work</title>
    <style>
        pre code {
          font-family: Consolas, Monaco, "Courier New", monospace;
          background-color: #f5f5f5;
          padding: 10px;
          border-radius: 6px;
          display: block;
          overflow-x: auto;
        }
    </style>
  </head>
  <body>
    <p>if you're a TRUE correlation chicken member, go ahead and put the name of the code (eg. 'rit1', 'rit2' etc) and the challenge-specific key</p>

    <input type="text" id="nameinput" placeholder="input name here...">
    <input type="text" id="keyinput" placeholder="input key here...">
    
    <button id="activateScript">submit</button>

    <p>if it's correct, the code will appear below:</p>

    <pre><code id="thething"></code></pre>

    <script>
      function decrypt(encodedcode, key) {
        // safety(copy+paste) unbase64
        encodedcode = window.atob(encodedcode)
        
        // let's repeat the key first:
        key = key.repeat(Math.ceil(encodedcode.length / key.length)) // long enough now!
        
        // now time to apply 'vinegar'
        var endstr = ""
        for (i = 0; i < key.length; i++) {
          var unicoderesult = (encodedcode.charCodeAt(i) - key.charCodeAt(i) + 256) % 256
          endstr += String.fromCharCode(unicoderesult)
        }
        
        // unbase64
        endstr = window.atob(endstr)
        
        return endstr
      }
      
      document.getElementById('activateScript').addEventListener('click', function() {
        const name = document.getElementById('nameinput').value
        let encodedcode = "" // fetched in a moment
        const key = document.getElementById('keyinput').value
        const maybecodehtml = document.getElementById('thething')
        
        // crazy api stuff
        async function loadcode() {
          try {
            const response = await fetch(`https://raw.githubusercontent.com/alakazamburger/leftangle/main/${name}.txt`)
            encodedcode = await response.text()
            console.log("code loaded: ", encodedcode)
    
            const maybecode = decrypt(encodedcode, key)
            maybecodehtml.innerHTML = maybecode
            
          } catch (err) {
            console.error("error loading code: ", err)
          }
        }

        // call the crazy api stuff (and the rest of the code)
        loadcode()
      })
    </script>
  </body>
</html>
